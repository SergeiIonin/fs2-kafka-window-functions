

releaseChunks for time-windows

{
            val keysSortedAsc = chunksMap.keySet.toList.sorted
            val keyLeft = keysSortedAsc.lastOption
            val mapChunksReleasing = keyLeft.fold(Map.empty[Long, Chunk[R]])(key => chunksMap.removed(key))
            val chunksMapUpd = keyLeft.fold(Map.empty[Long, Chunk[R]])(key => Map(key -> chunksMap(key)))

            chunksMapUpd -> {
              logger.info(s"${System.currentTimeMillis()} in the clearing stream")
              mapChunksReleasing.values.toList.traverse(onChunkRelease)
            }
          }

splitChunks = {
val keysSortedAsc = chunksMap.keySet.toList.sorted
            val keyLeft = keysSortedAsc.lastOption
            val mapChunksReleasing = keyLeft.fold(Map.empty[Long, Chunk[R]])(key => chunksMap.removed(key))
            val chunksMapUpd = keyLeft.fold(Map.empty[Long, Chunk[R]])(key => Map(key -> chunksMap(key)))
            chunksMapUpd -> mapChunksReleasing
            }
onCHunkRelese = mapChunksReleasing.values.toList.traverse(onChunkRelease)